#include <stdint.h>
#include "crc16buypass.h"

// This code assumes that unsigned is 4 bytes.

unsigned crc16buypass_bit(unsigned crc, void const *mem, size_t len) {
    unsigned char const *data = mem;
    if (data == NULL)
        return 0;
    while (len--) {
        crc ^= (unsigned)(*data++) << 8;
        for (unsigned k = 0; k < 8; k++)
            crc = crc & 0x8000 ? (crc << 1) ^ 0x8005 : crc << 1;
    }
    crc &= 0xffff;
    return crc;
}

unsigned crc16buypass_rem(unsigned crc, unsigned val, unsigned bits) {
    val &= 0x100 - (0x100 >> bits) ;
    crc ^= (unsigned)val << 8;
    while (bits--)
        crc = crc & 0x8000 ? (crc << 1) ^ 0x8005 : crc << 1;
    crc &= 0xffff;
    return crc;
}

static unsigned short const table_byte[] = {
    0x0000, 0x8005, 0x800f, 0x000a, 0x801b, 0x001e, 0x0014, 0x8011, 0x8033, 0x0036,
    0x003c, 0x8039, 0x0028, 0x802d, 0x8027, 0x0022, 0x8063, 0x0066, 0x006c, 0x8069,
    0x0078, 0x807d, 0x8077, 0x0072, 0x0050, 0x8055, 0x805f, 0x005a, 0x804b, 0x004e,
    0x0044, 0x8041, 0x80c3, 0x00c6, 0x00cc, 0x80c9, 0x00d8, 0x80dd, 0x80d7, 0x00d2,
    0x00f0, 0x80f5, 0x80ff, 0x00fa, 0x80eb, 0x00ee, 0x00e4, 0x80e1, 0x00a0, 0x80a5,
    0x80af, 0x00aa, 0x80bb, 0x00be, 0x00b4, 0x80b1, 0x8093, 0x0096, 0x009c, 0x8099,
    0x0088, 0x808d, 0x8087, 0x0082, 0x8183, 0x0186, 0x018c, 0x8189, 0x0198, 0x819d,
    0x8197, 0x0192, 0x01b0, 0x81b5, 0x81bf, 0x01ba, 0x81ab, 0x01ae, 0x01a4, 0x81a1,
    0x01e0, 0x81e5, 0x81ef, 0x01ea, 0x81fb, 0x01fe, 0x01f4, 0x81f1, 0x81d3, 0x01d6,
    0x01dc, 0x81d9, 0x01c8, 0x81cd, 0x81c7, 0x01c2, 0x0140, 0x8145, 0x814f, 0x014a,
    0x815b, 0x015e, 0x0154, 0x8151, 0x8173, 0x0176, 0x017c, 0x8179, 0x0168, 0x816d,
    0x8167, 0x0162, 0x8123, 0x0126, 0x012c, 0x8129, 0x0138, 0x813d, 0x8137, 0x0132,
    0x0110, 0x8115, 0x811f, 0x011a, 0x810b, 0x010e, 0x0104, 0x8101, 0x8303, 0x0306,
    0x030c, 0x8309, 0x0318, 0x831d, 0x8317, 0x0312, 0x0330, 0x8335, 0x833f, 0x033a,
    0x832b, 0x032e, 0x0324, 0x8321, 0x0360, 0x8365, 0x836f, 0x036a, 0x837b, 0x037e,
    0x0374, 0x8371, 0x8353, 0x0356, 0x035c, 0x8359, 0x0348, 0x834d, 0x8347, 0x0342,
    0x03c0, 0x83c5, 0x83cf, 0x03ca, 0x83db, 0x03de, 0x03d4, 0x83d1, 0x83f3, 0x03f6,
    0x03fc, 0x83f9, 0x03e8, 0x83ed, 0x83e7, 0x03e2, 0x83a3, 0x03a6, 0x03ac, 0x83a9,
    0x03b8, 0x83bd, 0x83b7, 0x03b2, 0x0390, 0x8395, 0x839f, 0x039a, 0x838b, 0x038e,
    0x0384, 0x8381, 0x0280, 0x8285, 0x828f, 0x028a, 0x829b, 0x029e, 0x0294, 0x8291,
    0x82b3, 0x02b6, 0x02bc, 0x82b9, 0x02a8, 0x82ad, 0x82a7, 0x02a2, 0x82e3, 0x02e6,
    0x02ec, 0x82e9, 0x02f8, 0x82fd, 0x82f7, 0x02f2, 0x02d0, 0x82d5, 0x82df, 0x02da,
    0x82cb, 0x02ce, 0x02c4, 0x82c1, 0x8243, 0x0246, 0x024c, 0x8249, 0x0258, 0x825d,
    0x8257, 0x0252, 0x0270, 0x8275, 0x827f, 0x027a, 0x826b, 0x026e, 0x0264, 0x8261,
    0x0220, 0x8225, 0x822f, 0x022a, 0x823b, 0x023e, 0x0234, 0x8231, 0x8213, 0x0216,
    0x021c, 0x8219, 0x0208, 0x820d, 0x8207, 0x0202
};

static unsigned short const table_word[][256] = {
   {0x0000, 0x0580, 0x0f80, 0x0a00, 0x1b80, 0x1e00, 0x1400, 0x1180, 0x3380, 0x3600,
    0x3c00, 0x3980, 0x2800, 0x2d80, 0x2780, 0x2200, 0x6380, 0x6600, 0x6c00, 0x6980,
    0x7800, 0x7d80, 0x7780, 0x7200, 0x5000, 0x5580, 0x5f80, 0x5a00, 0x4b80, 0x4e00,
    0x4400, 0x4180, 0xc380, 0xc600, 0xcc00, 0xc980, 0xd800, 0xdd80, 0xd780, 0xd200,
    0xf000, 0xf580, 0xff80, 0xfa00, 0xeb80, 0xee00, 0xe400, 0xe180, 0xa000, 0xa580,
    0xaf80, 0xaa00, 0xbb80, 0xbe00, 0xb400, 0xb180, 0x9380, 0x9600, 0x9c00, 0x9980,
    0x8800, 0x8d80, 0x8780, 0x8200, 0x8381, 0x8601, 0x8c01, 0x8981, 0x9801, 0x9d81,
    0x9781, 0x9201, 0xb001, 0xb581, 0xbf81, 0xba01, 0xab81, 0xae01, 0xa401, 0xa181,
    0xe001, 0xe581, 0xef81, 0xea01, 0xfb81, 0xfe01, 0xf401, 0xf181, 0xd381, 0xd601,
    0xdc01, 0xd981, 0xc801, 0xcd81, 0xc781, 0xc201, 0x4001, 0x4581, 0x4f81, 0x4a01,
    0x5b81, 0x5e01, 0x5401, 0x5181, 0x7381, 0x7601, 0x7c01, 0x7981, 0x6801, 0x6d81,
    0x6781, 0x6201, 0x2381, 0x2601, 0x2c01, 0x2981, 0x3801, 0x3d81, 0x3781, 0x3201,
    0x1001, 0x1581, 0x1f81, 0x1a01, 0x0b81, 0x0e01, 0x0401, 0x0181, 0x0383, 0x0603,
    0x0c03, 0x0983, 0x1803, 0x1d83, 0x1783, 0x1203, 0x3003, 0x3583, 0x3f83, 0x3a03,
    0x2b83, 0x2e03, 0x2403, 0x2183, 0x6003, 0x6583, 0x6f83, 0x6a03, 0x7b83, 0x7e03,
    0x7403, 0x7183, 0x5383, 0x5603, 0x5c03, 0x5983, 0x4803, 0x4d83, 0x4783, 0x4203,
    0xc003, 0xc583, 0xcf83, 0xca03, 0xdb83, 0xde03, 0xd403, 0xd183, 0xf383, 0xf603,
    0xfc03, 0xf983, 0xe803, 0xed83, 0xe783, 0xe203, 0xa383, 0xa603, 0xac03, 0xa983,
    0xb803, 0xbd83, 0xb783, 0xb203, 0x9003, 0x9583, 0x9f83, 0x9a03, 0x8b83, 0x8e03,
    0x8403, 0x8183, 0x8002, 0x8582, 0x8f82, 0x8a02, 0x9b82, 0x9e02, 0x9402, 0x9182,
    0xb382, 0xb602, 0xbc02, 0xb982, 0xa802, 0xad82, 0xa782, 0xa202, 0xe382, 0xe602,
    0xec02, 0xe982, 0xf802, 0xfd82, 0xf782, 0xf202, 0xd002, 0xd582, 0xdf82, 0xda02,
    0xcb82, 0xce02, 0xc402, 0xc182, 0x4382, 0x4602, 0x4c02, 0x4982, 0x5802, 0x5d82,
    0x5782, 0x5202, 0x7002, 0x7582, 0x7f82, 0x7a02, 0x6b82, 0x6e02, 0x6402, 0x6182,
    0x2002, 0x2582, 0x2f82, 0x2a02, 0x3b82, 0x3e02, 0x3402, 0x3182, 0x1382, 0x1602,
    0x1c02, 0x1982, 0x0802, 0x0d82, 0x0782, 0x0202},
   {0x0000, 0x0386, 0x038c, 0x000a, 0x0398, 0x001e, 0x0014, 0x0392, 0x03b0, 0x0036,
    0x003c, 0x03ba, 0x0028, 0x03ae, 0x03a4, 0x0022, 0x03e0, 0x0066, 0x006c, 0x03ea,
    0x0078, 0x03fe, 0x03f4, 0x0072, 0x0050, 0x03d6, 0x03dc, 0x005a, 0x03c8, 0x004e,
    0x0044, 0x03c2, 0x0340, 0x00c6, 0x00cc, 0x034a, 0x00d8, 0x035e, 0x0354, 0x00d2,
    0x00f0, 0x0376, 0x037c, 0x00fa, 0x0368, 0x00ee, 0x00e4, 0x0362, 0x00a0, 0x0326,
    0x032c, 0x00aa, 0x0338, 0x00be, 0x00b4, 0x0332, 0x0310, 0x0096, 0x009c, 0x031a,
    0x0088, 0x030e, 0x0304, 0x0082, 0x0680, 0x0506, 0x050c, 0x068a, 0x0518, 0x069e,
    0x0694, 0x0512, 0x0530, 0x06b6, 0x06bc, 0x053a, 0x06a8, 0x052e, 0x0524, 0x06a2,
    0x0560, 0x06e6, 0x06ec, 0x056a, 0x06f8, 0x057e, 0x0574, 0x06f2, 0x06d0, 0x0556,
    0x055c, 0x06da, 0x0548, 0x06ce, 0x06c4, 0x0542, 0x05c0, 0x0646, 0x064c, 0x05ca,
    0x0658, 0x05de, 0x05d4, 0x0652, 0x0670, 0x05f6, 0x05fc, 0x067a, 0x05e8, 0x066e,
    0x0664, 0x05e2, 0x0620, 0x05a6, 0x05ac, 0x062a, 0x05b8, 0x063e, 0x0634, 0x05b2,
    0x0590, 0x0616, 0x061c, 0x059a, 0x0608, 0x058e, 0x0584, 0x0602, 0x0980, 0x0a06,
    0x0a0c, 0x098a, 0x0a18, 0x099e, 0x0994, 0x0a12, 0x0a30, 0x09b6, 0x09bc, 0x0a3a,
    0x09a8, 0x0a2e, 0x0a24, 0x09a2, 0x0a60, 0x09e6, 0x09ec, 0x0a6a, 0x09f8, 0x0a7e,
    0x0a74, 0x09f2, 0x09d0, 0x0a56, 0x0a5c, 0x09da, 0x0a48, 0x09ce, 0x09c4, 0x0a42,
    0x0ac0, 0x0946, 0x094c, 0x0aca, 0x0958, 0x0ade, 0x0ad4, 0x0952, 0x0970, 0x0af6,
    0x0afc, 0x097a, 0x0ae8, 0x096e, 0x0964, 0x0ae2, 0x0920, 0x0aa6, 0x0aac, 0x092a,
    0x0ab8, 0x093e, 0x0934, 0x0ab2, 0x0a90, 0x0916, 0x091c, 0x0a9a, 0x0908, 0x0a8e,
    0x0a84, 0x0902, 0x0f00, 0x0c86, 0x0c8c, 0x0f0a, 0x0c98, 0x0f1e, 0x0f14, 0x0c92,
    0x0cb0, 0x0f36, 0x0f3c, 0x0cba, 0x0f28, 0x0cae, 0x0ca4, 0x0f22, 0x0ce0, 0x0f66,
    0x0f6c, 0x0cea, 0x0f78, 0x0cfe, 0x0cf4, 0x0f72, 0x0f50, 0x0cd6, 0x0cdc, 0x0f5a,
    0x0cc8, 0x0f4e, 0x0f44, 0x0cc2, 0x0c40, 0x0fc6, 0x0fcc, 0x0c4a, 0x0fd8, 0x0c5e,
    0x0c54, 0x0fd2, 0x0ff0, 0x0c76, 0x0c7c, 0x0ffa, 0x0c68, 0x0fee, 0x0fe4, 0x0c62,
    0x0fa0, 0x0c26, 0x0c2c, 0x0faa, 0x0c38, 0x0fbe, 0x0fb4, 0x0c32, 0x0c10, 0x0f96,
    0x0f9c, 0x0c1a, 0x0f88, 0x0c0e, 0x0c04, 0x0f82},
   {0x0000, 0x1780, 0x2b80, 0x3c00, 0x5380, 0x4400, 0x7800, 0x6f80, 0xa380, 0xb400,
    0x8800, 0x9f80, 0xf000, 0xe780, 0xdb80, 0xcc00, 0x4381, 0x5401, 0x6801, 0x7f81,
    0x1001, 0x0781, 0x3b81, 0x2c01, 0xe001, 0xf781, 0xcb81, 0xdc01, 0xb381, 0xa401,
    0x9801, 0x8f81, 0x8382, 0x9402, 0xa802, 0xbf82, 0xd002, 0xc782, 0xfb82, 0xec02,
    0x2002, 0x3782, 0x0b82, 0x1c02, 0x7382, 0x6402, 0x5802, 0x4f82, 0xc003, 0xd783,
    0xeb83, 0xfc03, 0x9383, 0x8403, 0xb803, 0xaf83, 0x6383, 0x7403, 0x4803, 0x5f83,
    0x3003, 0x2783, 0x1b83, 0x0c03, 0x0385, 0x1405, 0x2805, 0x3f85, 0x5005, 0x4785,
    0x7b85, 0x6c05, 0xa005, 0xb785, 0x8b85, 0x9c05, 0xf385, 0xe405, 0xd805, 0xcf85,
    0x4004, 0x5784, 0x6b84, 0x7c04, 0x1384, 0x0404, 0x3804, 0x2f84, 0xe384, 0xf404,
    0xc804, 0xdf84, 0xb004, 0xa784, 0x9b84, 0x8c04, 0x8007, 0x9787, 0xab87, 0xbc07,
    0xd387, 0xc407, 0xf807, 0xef87, 0x2387, 0x3407, 0x0807, 0x1f87, 0x7007, 0x6787,
    0x5b87, 0x4c07, 0xc386, 0xd406, 0xe806, 0xff86, 0x9006, 0x8786, 0xbb86, 0xac06,
    0x6006, 0x7786, 0x4b86, 0x5c06, 0x3386, 0x2406, 0x1806, 0x0f86, 0x038a, 0x140a,
    0x280a, 0x3f8a, 0x500a, 0x478a, 0x7b8a, 0x6c0a, 0xa00a, 0xb78a, 0x8b8a, 0x9c0a,
    0xf38a, 0xe40a, 0xd80a, 0xcf8a, 0x400b, 0x578b, 0x6b8b, 0x7c0b, 0x138b, 0x040b,
    0x380b, 0x2f8b, 0xe38b, 0xf40b, 0xc80b, 0xdf8b, 0xb00b, 0xa78b, 0x9b8b, 0x8c0b,
    0x8008, 0x9788, 0xab88, 0xbc08, 0xd388, 0xc408, 0xf808, 0xef88, 0x2388, 0x3408,
    0x0808, 0x1f88, 0x7008, 0x6788, 0x5b88, 0x4c08, 0xc389, 0xd409, 0xe809, 0xff89,
    0x9009, 0x8789, 0xbb89, 0xac09, 0x6009, 0x7789, 0x4b89, 0x5c09, 0x3389, 0x2409,
    0x1809, 0x0f89, 0x000f, 0x178f, 0x2b8f, 0x3c0f, 0x538f, 0x440f, 0x780f, 0x6f8f,
    0xa38f, 0xb40f, 0x880f, 0x9f8f, 0xf00f, 0xe78f, 0xdb8f, 0xcc0f, 0x438e, 0x540e,
    0x680e, 0x7f8e, 0x100e, 0x078e, 0x3b8e, 0x2c0e, 0xe00e, 0xf78e, 0xcb8e, 0xdc0e,
    0xb38e, 0xa40e, 0x980e, 0x8f8e, 0x838d, 0x940d, 0xa80d, 0xbf8d, 0xd00d, 0xc78d,
    0xfb8d, 0xec0d, 0x200d, 0x378d, 0x0b8d, 0x1c0d, 0x738d, 0x640d, 0x580d, 0x4f8d,
    0xc00c, 0xd78c, 0xeb8c, 0xfc0c, 0x938c, 0x840c, 0xb80c, 0xaf8c, 0x638c, 0x740c,
    0x480c, 0x5f8c, 0x300c, 0x278c, 0x1b8c, 0x0c0c},
   {0x0000, 0x0394, 0x03a8, 0x003c, 0x03d0, 0x0044, 0x0078, 0x03ec, 0x0320, 0x00b4,
    0x0088, 0x031c, 0x00f0, 0x0364, 0x0358, 0x00cc, 0x0640, 0x05d4, 0x05e8, 0x067c,
    0x0590, 0x0604, 0x0638, 0x05ac, 0x0560, 0x06f4, 0x06c8, 0x055c, 0x06b0, 0x0524,
    0x0518, 0x068c, 0x0c80, 0x0f14, 0x0f28, 0x0cbc, 0x0f50, 0x0cc4, 0x0cf8, 0x0f6c,
    0x0fa0, 0x0c34, 0x0c08, 0x0f9c, 0x0c70, 0x0fe4, 0x0fd8, 0x0c4c, 0x0ac0, 0x0954,
    0x0968, 0x0afc, 0x0910, 0x0a84, 0x0ab8, 0x092c, 0x09e0, 0x0a74, 0x0a48, 0x09dc,
    0x0a30, 0x09a4, 0x0998, 0x0a0c, 0x1d80, 0x1e14, 0x1e28, 0x1dbc, 0x1e50, 0x1dc4,
    0x1df8, 0x1e6c, 0x1ea0, 0x1d34, 0x1d08, 0x1e9c, 0x1d70, 0x1ee4, 0x1ed8, 0x1d4c,
    0x1bc0, 0x1854, 0x1868, 0x1bfc, 0x1810, 0x1b84, 0x1bb8, 0x182c, 0x18e0, 0x1b74,
    0x1b48, 0x18dc, 0x1b30, 0x18a4, 0x1898, 0x1b0c, 0x1100, 0x1294, 0x12a8, 0x113c,
    0x12d0, 0x1144, 0x1178, 0x12ec, 0x1220, 0x11b4, 0x1188, 0x121c, 0x11f0, 0x1264,
    0x1258, 0x11cc, 0x1740, 0x14d4, 0x14e8, 0x177c, 0x1490, 0x1704, 0x1738, 0x14ac,
    0x1460, 0x17f4, 0x17c8, 0x145c, 0x17b0, 0x1424, 0x1418, 0x178c, 0x3f80, 0x3c14,
    0x3c28, 0x3fbc, 0x3c50, 0x3fc4, 0x3ff8, 0x3c6c, 0x3ca0, 0x3f34, 0x3f08, 0x3c9c,
    0x3f70, 0x3ce4, 0x3cd8, 0x3f4c, 0x39c0, 0x3a54, 0x3a68, 0x39fc, 0x3a10, 0x3984,
    0x39b8, 0x3a2c, 0x3ae0, 0x3974, 0x3948, 0x3adc, 0x3930, 0x3aa4, 0x3a98, 0x390c,
    0x3300, 0x3094, 0x30a8, 0x333c, 0x30d0, 0x3344, 0x3378, 0x30ec, 0x3020, 0x33b4,
    0x3388, 0x301c, 0x33f0, 0x3064, 0x3058, 0x33cc, 0x3540, 0x36d4, 0x36e8, 0x357c,
    0x3690, 0x3504, 0x3538, 0x36ac, 0x3660, 0x35f4, 0x35c8, 0x365c, 0x35b0, 0x3624,
    0x3618, 0x358c, 0x2200, 0x2194, 0x21a8, 0x223c, 0x21d0, 0x2244, 0x2278, 0x21ec,
    0x2120, 0x22b4, 0x2288, 0x211c, 0x22f0, 0x2164, 0x2158, 0x22cc, 0x2440, 0x27d4,
    0x27e8, 0x247c, 0x2790, 0x2404, 0x2438, 0x27ac, 0x2760, 0x24f4, 0x24c8, 0x275c,
    0x24b0, 0x2724, 0x2718, 0x248c, 0x2e80, 0x2d14, 0x2d28, 0x2ebc, 0x2d50, 0x2ec4,
    0x2ef8, 0x2d6c, 0x2da0, 0x2e34, 0x2e08, 0x2d9c, 0x2e70, 0x2de4, 0x2dd8, 0x2e4c,
    0x28c0, 0x2b54, 0x2b68, 0x28fc, 0x2b10, 0x2884, 0x28b8, 0x2b2c, 0x2be0, 0x2874,
    0x2848, 0x2bdc, 0x2830, 0x2ba4, 0x2b98, 0x280c},
   {0x0000, 0x7b80, 0xf380, 0x8800, 0xe381, 0x9801, 0x1001, 0x6b81, 0xc383, 0xb803,
    0x3003, 0x4b83, 0x2002, 0x5b82, 0xd382, 0xa802, 0x8387, 0xf807, 0x7007, 0x0b87,
    0x6006, 0x1b86, 0x9386, 0xe806, 0x4004, 0x3b84, 0xb384, 0xc804, 0xa385, 0xd805,
    0x5005, 0x2b85, 0x038f, 0x780f, 0xf00f, 0x8b8f, 0xe00e, 0x9b8e, 0x138e, 0x680e,
    0xc00c, 0xbb8c, 0x338c, 0x480c, 0x238d, 0x580d, 0xd00d, 0xab8d, 0x8008, 0xfb88,
    0x7388, 0x0808, 0x6389, 0x1809, 0x9009, 0xeb89, 0x438b, 0x380b, 0xb00b, 0xcb8b,
    0xa00a, 0xdb8a, 0x538a, 0x280a, 0x039e, 0x781e, 0xf01e, 0x8b9e, 0xe01f, 0x9b9f,
    0x139f, 0x681f, 0xc01d, 0xbb9d, 0x339d, 0x481d, 0x239c, 0x581c, 0xd01c, 0xab9c,
    0x8019, 0xfb99, 0x7399, 0x0819, 0x6398, 0x1818, 0x9018, 0xeb98, 0x439a, 0x381a,
    0xb01a, 0xcb9a, 0xa01b, 0xdb9b, 0x539b, 0x281b, 0x0011, 0x7b91, 0xf391, 0x8811,
    0xe390, 0x9810, 0x1010, 0x6b90, 0xc392, 0xb812, 0x3012, 0x4b92, 0x2013, 0x5b93,
    0xd393, 0xa813, 0x8396, 0xf816, 0x7016, 0x0b96, 0x6017, 0x1b97, 0x9397, 0xe817,
    0x4015, 0x3b95, 0xb395, 0xc815, 0xa394, 0xd814, 0x5014, 0x2b94, 0x03bc, 0x783c,
    0xf03c, 0x8bbc, 0xe03d, 0x9bbd, 0x13bd, 0x683d, 0xc03f, 0xbbbf, 0x33bf, 0x483f,
    0x23be, 0x583e, 0xd03e, 0xabbe, 0x803b, 0xfbbb, 0x73bb, 0x083b, 0x63ba, 0x183a,
    0x903a, 0xebba, 0x43b8, 0x3838, 0xb038, 0xcbb8, 0xa039, 0xdbb9, 0x53b9, 0x2839,
    0x0033, 0x7bb3, 0xf3b3, 0x8833, 0xe3b2, 0x9832, 0x1032, 0x6bb2, 0xc3b0, 0xb830,
    0x3030, 0x4bb0, 0x2031, 0x5bb1, 0xd3b1, 0xa831, 0x83b4, 0xf834, 0x7034, 0x0bb4,
    0x6035, 0x1bb5, 0x93b5, 0xe835, 0x4037, 0x3bb7, 0xb3b7, 0xc837, 0xa3b6, 0xd836,
    0x5036, 0x2bb6, 0x0022, 0x7ba2, 0xf3a2, 0x8822, 0xe3a3, 0x9823, 0x1023, 0x6ba3,
    0xc3a1, 0xb821, 0x3021, 0x4ba1, 0x2020, 0x5ba0, 0xd3a0, 0xa820, 0x83a5, 0xf825,
    0x7025, 0x0ba5, 0x6024, 0x1ba4, 0x93a4, 0xe824, 0x4026, 0x3ba6, 0xb3a6, 0xc826,
    0xa3a7, 0xd827, 0x5027, 0x2ba7, 0x03ad, 0x782d, 0xf02d, 0x8bad, 0xe02c, 0x9bac,
    0x13ac, 0x682c, 0xc02e, 0xbbae, 0x33ae, 0x482e, 0x23af, 0x582f, 0xd02f, 0xabaf,
    0x802a, 0xfbaa, 0x73aa, 0x082a, 0x63ab, 0x182b, 0x902b, 0xebab, 0x43a9, 0x3829,
    0xb029, 0xcba9, 0xa028, 0xdba8, 0x53a8, 0x2828},
   {0x0000, 0x03f8, 0x0370, 0x0088, 0x06e0, 0x0518, 0x0590, 0x0668, 0x0940, 0x0ab8,
    0x0a30, 0x09c8, 0x0fa0, 0x0c58, 0x0cd0, 0x0f28, 0x1280, 0x1178, 0x11f0, 0x1208,
    0x1460, 0x1798, 0x1710, 0x14e8, 0x1bc0, 0x1838, 0x18b0, 0x1b48, 0x1d20, 0x1ed8,
    0x1e50, 0x1da8, 0x2180, 0x2278, 0x22f0, 0x2108, 0x2760, 0x2498, 0x2410, 0x27e8,
    0x28c0, 0x2b38, 0x2bb0, 0x2848, 0x2e20, 0x2dd8, 0x2d50, 0x2ea8, 0x3300, 0x30f8,
    0x3070, 0x3388, 0x35e0, 0x3618, 0x3690, 0x3568, 0x3a40, 0x39b8, 0x3930, 0x3ac8,
    0x3ca0, 0x3f58, 0x3fd0, 0x3c28, 0x4780, 0x4478, 0x44f0, 0x4708, 0x4160, 0x4298,
    0x4210, 0x41e8, 0x4ec0, 0x4d38, 0x4db0, 0x4e48, 0x4820, 0x4bd8, 0x4b50, 0x48a8,
    0x5500, 0x56f8, 0x5670, 0x5588, 0x53e0, 0x5018, 0x5090, 0x5368, 0x5c40, 0x5fb8,
    0x5f30, 0x5cc8, 0x5aa0, 0x5958, 0x59d0, 0x5a28, 0x6600, 0x65f8, 0x6570, 0x6688,
    0x60e0, 0x6318, 0x6390, 0x6068, 0x6f40, 0x6cb8, 0x6c30, 0x6fc8, 0x69a0, 0x6a58,
    0x6ad0, 0x6928, 0x7480, 0x7778, 0x77f0, 0x7408, 0x7260, 0x7198, 0x7110, 0x72e8,
    0x7dc0, 0x7e38, 0x7eb0, 0x7d48, 0x7b20, 0x78d8, 0x7850, 0x7ba8, 0x8b80, 0x8878,
    0x88f0, 0x8b08, 0x8d60, 0x8e98, 0x8e10, 0x8de8, 0x82c0, 0x8138, 0x81b0, 0x8248,
    0x8420, 0x87d8, 0x8750, 0x84a8, 0x9900, 0x9af8, 0x9a70, 0x9988, 0x9fe0, 0x9c18,
    0x9c90, 0x9f68, 0x9040, 0x93b8, 0x9330, 0x90c8, 0x96a0, 0x9558, 0x95d0, 0x9628,
    0xaa00, 0xa9f8, 0xa970, 0xaa88, 0xace0, 0xaf18, 0xaf90, 0xac68, 0xa340, 0xa0b8,
    0xa030, 0xa3c8, 0xa5a0, 0xa658, 0xa6d0, 0xa528, 0xb880, 0xbb78, 0xbbf0, 0xb808,
    0xbe60, 0xbd98, 0xbd10, 0xbee8, 0xb1c0, 0xb238, 0xb2b0, 0xb148, 0xb720, 0xb4d8,
    0xb450, 0xb7a8, 0xcc00, 0xcff8, 0xcf70, 0xcc88, 0xcae0, 0xc918, 0xc990, 0xca68,
    0xc540, 0xc6b8, 0xc630, 0xc5c8, 0xc3a0, 0xc058, 0xc0d0, 0xc328, 0xde80, 0xdd78,
    0xddf0, 0xde08, 0xd860, 0xdb98, 0xdb10, 0xd8e8, 0xd7c0, 0xd438, 0xd4b0, 0xd748,
    0xd120, 0xd2d8, 0xd250, 0xd1a8, 0xed80, 0xee78, 0xeef0, 0xed08, 0xeb60, 0xe898,
    0xe810, 0xebe8, 0xe4c0, 0xe738, 0xe7b0, 0xe448, 0xe220, 0xe1d8, 0xe150, 0xe2a8,
    0xff00, 0xfcf8, 0xfc70, 0xff88, 0xf9e0, 0xfa18, 0xfa90, 0xf968, 0xf640, 0xf5b8,
    0xf530, 0xf6c8, 0xf0a0, 0xf358, 0xf3d0, 0xf028},
   {0x0000, 0x1381, 0x2382, 0x3003, 0x4384, 0x5005, 0x6006, 0x7387, 0x8388, 0x9009,
    0xa00a, 0xb38b, 0xc00c, 0xd38d, 0xe38e, 0xf00f, 0x0391, 0x1010, 0x2013, 0x3392,
    0x4015, 0x5394, 0x6397, 0x7016, 0x8019, 0x9398, 0xa39b, 0xb01a, 0xc39d, 0xd01c,
    0xe01f, 0xf39e, 0x03a2, 0x1023, 0x2020, 0x33a1, 0x4026, 0x53a7, 0x63a4, 0x7025,
    0x802a, 0x93ab, 0xa3a8, 0xb029, 0xc3ae, 0xd02f, 0xe02c, 0xf3ad, 0x0033, 0x13b2,
    0x23b1, 0x3030, 0x43b7, 0x5036, 0x6035, 0x73b4, 0x83bb, 0x903a, 0xa039, 0xb3b8,
    0xc03f, 0xd3be, 0xe3bd, 0xf03c, 0x03c4, 0x1045, 0x2046, 0x33c7, 0x4040, 0x53c1,
    0x63c2, 0x7043, 0x804c, 0x93cd, 0xa3ce, 0xb04f, 0xc3c8, 0xd049, 0xe04a, 0xf3cb,
    0x0055, 0x13d4, 0x23d7, 0x3056, 0x43d1, 0x5050, 0x6053, 0x73d2, 0x83dd, 0x905c,
    0xa05f, 0xb3de, 0xc059, 0xd3d8, 0xe3db, 0xf05a, 0x0066, 0x13e7, 0x23e4, 0x3065,
    0x43e2, 0x5063, 0x6060, 0x73e1, 0x83ee, 0x906f, 0xa06c, 0xb3ed, 0xc06a, 0xd3eb,
    0xe3e8, 0xf069, 0x03f7, 0x1076, 0x2075, 0x33f4, 0x4073, 0x53f2, 0x63f1, 0x7070,
    0x807f, 0x93fe, 0xa3fd, 0xb07c, 0xc3fb, 0xd07a, 0xe079, 0xf3f8, 0x0308, 0x1089,
    0x208a, 0x330b, 0x408c, 0x530d, 0x630e, 0x708f, 0x8080, 0x9301, 0xa302, 0xb083,
    0xc304, 0xd085, 0xe086, 0xf307, 0x0099, 0x1318, 0x231b, 0x309a, 0x431d, 0x509c,
    0x609f, 0x731e, 0x8311, 0x9090, 0xa093, 0xb312, 0xc095, 0xd314, 0xe317, 0xf096,
    0x00aa, 0x132b, 0x2328, 0x30a9, 0x432e, 0x50af, 0x60ac, 0x732d, 0x8322, 0x90a3,
    0xa0a0, 0xb321, 0xc0a6, 0xd327, 0xe324, 0xf0a5, 0x033b, 0x10ba, 0x20b9, 0x3338,
    0x40bf, 0x533e, 0x633d, 0x70bc, 0x80b3, 0x9332, 0xa331, 0xb0b0, 0xc337, 0xd0b6,
    0xe0b5, 0xf334, 0x00cc, 0x134d, 0x234e, 0x30cf, 0x4348, 0x50c9, 0x60ca, 0x734b,
    0x8344, 0x90c5, 0xa0c6, 0xb347, 0xc0c0, 0xd341, 0xe342, 0xf0c3, 0x035d, 0x10dc,
    0x20df, 0x335e, 0x40d9, 0x5358, 0x635b, 0x70da, 0x80d5, 0x9354, 0xa357, 0xb0d6,
    0xc351, 0xd0d0, 0xe0d3, 0xf352, 0x036e, 0x10ef, 0x20ec, 0x336d, 0x40ea, 0x536b,
    0x6368, 0x70e9, 0x80e6, 0x9367, 0xa364, 0xb0e5, 0xc362, 0xd0e3, 0xe0e0, 0xf361,
    0x00ff, 0x137e, 0x237d, 0x30fc, 0x437b, 0x50fa, 0x60f9, 0x7378, 0x8377, 0x90f6,
    0xa0f5, 0xb374, 0xc0f3, 0xd372, 0xe371, 0xf0f0},
   {0x0000, 0x0610, 0x0c20, 0x0a30, 0x1840, 0x1e50, 0x1460, 0x1270, 0x3080, 0x3690,
    0x3ca0, 0x3ab0, 0x28c0, 0x2ed0, 0x24e0, 0x22f0, 0x6580, 0x6390, 0x69a0, 0x6fb0,
    0x7dc0, 0x7bd0, 0x71e0, 0x77f0, 0x5500, 0x5310, 0x5920, 0x5f30, 0x4d40, 0x4b50,
    0x4160, 0x4770, 0xcf80, 0xc990, 0xc3a0, 0xc5b0, 0xd7c0, 0xd1d0, 0xdbe0, 0xddf0,
    0xff00, 0xf910, 0xf320, 0xf530, 0xe740, 0xe150, 0xeb60, 0xed70, 0xaa00, 0xac10,
    0xa620, 0xa030, 0xb240, 0xb450, 0xbe60, 0xb870, 0x9a80, 0x9c90, 0x96a0, 0x90b0,
    0x82c0, 0x84d0, 0x8ee0, 0x88f0, 0x9b81, 0x9d91, 0x97a1, 0x91b1, 0x83c1, 0x85d1,
    0x8fe1, 0x89f1, 0xab01, 0xad11, 0xa721, 0xa131, 0xb341, 0xb551, 0xbf61, 0xb971,
    0xfe01, 0xf811, 0xf221, 0xf431, 0xe641, 0xe051, 0xea61, 0xec71, 0xce81, 0xc891,
    0xc2a1, 0xc4b1, 0xd6c1, 0xd0d1, 0xdae1, 0xdcf1, 0x5401, 0x5211, 0x5821, 0x5e31,
    0x4c41, 0x4a51, 0x4061, 0x4671, 0x6481, 0x6291, 0x68a1, 0x6eb1, 0x7cc1, 0x7ad1,
    0x70e1, 0x76f1, 0x3181, 0x3791, 0x3da1, 0x3bb1, 0x29c1, 0x2fd1, 0x25e1, 0x23f1,
    0x0101, 0x0711, 0x0d21, 0x0b31, 0x1941, 0x1f51, 0x1561, 0x1371, 0x3383, 0x3593,
    0x3fa3, 0x39b3, 0x2bc3, 0x2dd3, 0x27e3, 0x21f3, 0x0303, 0x0513, 0x0f23, 0x0933,
    0x1b43, 0x1d53, 0x1763, 0x1173, 0x5603, 0x5013, 0x5a23, 0x5c33, 0x4e43, 0x4853,
    0x4263, 0x4473, 0x6683, 0x6093, 0x6aa3, 0x6cb3, 0x7ec3, 0x78d3, 0x72e3, 0x74f3,
    0xfc03, 0xfa13, 0xf023, 0xf633, 0xe443, 0xe253, 0xe863, 0xee73, 0xcc83, 0xca93,
    0xc0a3, 0xc6b3, 0xd4c3, 0xd2d3, 0xd8e3, 0xdef3, 0x9983, 0x9f93, 0x95a3, 0x93b3,
    0x81c3, 0x87d3, 0x8de3, 0x8bf3, 0xa903, 0xaf13, 0xa523, 0xa333, 0xb143, 0xb753,
    0xbd63, 0xbb73, 0xa802, 0xae12, 0xa422, 0xa232, 0xb042, 0xb652, 0xbc62, 0xba72,
    0x9882, 0x9e92, 0x94a2, 0x92b2, 0x80c2, 0x86d2, 0x8ce2, 0x8af2, 0xcd82, 0xcb92,
    0xc1a2, 0xc7b2, 0xd5c2, 0xd3d2, 0xd9e2, 0xdff2, 0xfd02, 0xfb12, 0xf122, 0xf732,
    0xe542, 0xe352, 0xe962, 0xef72, 0x6782, 0x6192, 0x6ba2, 0x6db2, 0x7fc2, 0x79d2,
    0x73e2, 0x75f2, 0x5702, 0x5112, 0x5b22, 0x5d32, 0x4f42, 0x4952, 0x4362, 0x4572,
    0x0202, 0x0412, 0x0e22, 0x0832, 0x1a42, 0x1c52, 0x1662, 0x1072, 0x3282, 0x3492,
    0x3ea2, 0x38b2, 0x2ac2, 0x2cd2, 0x26e2, 0x20f2}
};

unsigned crc16buypass_byte(unsigned crc, void const *mem, size_t len) {
    unsigned char const *data = mem;
    if (data == NULL)
        return 0;
    while (len--)
        crc = (crc << 8) ^
              table_byte[((crc >> 8) ^ *data++) & 0xff];
    crc &= 0xffff;
    return crc;
}

static inline unsigned swaplow(unsigned crc) {
    return
        ((crc & 0xff) << 8) +
        ((crc & 0xff00) >> 8);
}

// This code assumes that integers are stored little-endian.

unsigned crc16buypass_word(unsigned crc, void const *mem, size_t len) {
    unsigned char const *data = mem;
    if (data == NULL)
        return 0;
    while (len && ((ptrdiff_t)data & 0x7)) {
        crc = (crc << 8) ^
              table_byte[((crc >> 8) ^ *data++) & 0xff];
        len--;
    }
    if (len >= 8) {
        crc = swaplow(crc);
        do {
            uintmax_t word = crc ^ *(uintmax_t const *)data;
            crc = table_word[7][word & 0xff] ^
                  table_word[6][(word >> 8) & 0xff] ^
                  table_word[5][(word >> 16) & 0xff] ^
                  table_word[4][(word >> 24) & 0xff] ^
                  table_word[3][(word >> 32) & 0xff] ^
                  table_word[2][(word >> 40) & 0xff] ^
                  table_word[1][(word >> 48) & 0xff] ^
                  table_word[0][word >> 56];
            data += 8;
            len -= 8;
        } while (len >= 8);
        crc = swaplow(crc);
    }
    while (len--)
        crc = (crc << 8) ^
              table_byte[((crc >> 8) ^ *data++) & 0xff];
    crc &= 0xffff;
    return crc;
}
